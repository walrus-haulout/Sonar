# Nixpacks configuration for SEAL Key Server
# Railway will use this to build the Rust project

[phases.setup]
nixPkgs = ["rustc", "cargo", "openssl", "pkg-config", "libpq", "python3", "socat", "curl"]

[phases.build]
commands = [
  "cd seal",
  "cargo build --bin seal-cli --release --config net.git-fetch-with-cli=true",
  "cargo build --bin key-server --release --config net.git-fetch-with-cli=true"
]

[phases.install]
commands = [
  "mkdir -p /opt/key-server/bin",
  "cp seal/target/release/key-server /opt/key-server/bin/",
  "cp seal/target/release/seal-cli /opt/key-server/bin/"
]

[start]
command = "./start.sh"

