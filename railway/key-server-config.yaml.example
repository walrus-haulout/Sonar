# =============================================================================
# SEAL Key Server Configuration Template
# =============================================================================
# This template is public (committed to git) and shows the structure.
# Actual secrets are replaced at runtime from Railway environment variables.
#
# For deployment:
# 1. Set MASTER_KEY in Railway secrets
# 2. Set KEY_SERVER_OBJECT_ID in Railway secrets
# 3. Dockerfile substitutes REPLACE_KEY_SERVER_OBJECT_ID at startup

# Sui network configuration
# NOTE: For Mainnet deployment, ensure:
# 1. SONAR package is deployed to Mainnet (see railway/MAINNET_DEPLOYMENT.md)
# 2. KEY_SERVER_OBJECT_ID is registered on Mainnet
# 3. package_ids below use your Mainnet package ID
network: Mainnet

# Server mode: Permissioned (only SONAR package can request keys)
server_mode: !Permissioned
  client_configs:
    # SONAR Marketplace Configuration
    - name: "SONAR Marketplace"

      # Key server object ID (registered on-chain)
      # THIS VALUE IS REPLACED AT RUNTIME from Railway secret: KEY_SERVER_OBJECT_ID
      # Placeholder format: valid Sui address (64 hex chars with 0x prefix)
      key_server_object_id: "0x0000000000000000000000000000000000000000000000000000000000000000"

      # Allowed package IDs (only these can request derived keys)
      # SONAR Mainnet package ID (deployed 2025-11-06)
      # Testnet ID (for reference): 0x7375bdf0438c9430cb230a5ac0a278d1cba97dd991a2635a29055ce75825a7f4
      package_ids:
        - "0x63d29adf5adde737a28f9a541f62070c251e1cc0bd5c76d96d4e5800cfd77950"

      # Client master key derivation
      # Uses MASTER_KEY environment variable with derivation_index 0
      client_master_key: !Derived
        derivation_index: 0

# Optional: Prometheus metrics endpoint
# Exposed on port 9184 for monitoring
metrics_host_port: 9184

# Optional: SDK version requirement (enforce minimum client version)
# sdk_version_requirement: ">=1.0.0"

# Optional: Advanced timing parameters (defaults are usually fine)
# checkpoint_update_interval: 30s
# rgp_update_interval: 30s
# allowed_staleness: 60s
# session_key_ttl_max: 3600s
